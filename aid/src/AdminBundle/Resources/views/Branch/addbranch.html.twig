{% extends "AdminBundle::Layout/adminlayout.html.twig" %}
{% block title %} Branch {% endblock %}
{% block css %}
	
{% endblock %}
{% block content %}
	  
	<section class="content-header" >
		
      <h1>
            Add -Update Branch
		</h1>
		  <small></small>

		<ol class="breadcrumb">
		  <li><a href="{{path('admin_dashboard_index',{'domain':app.session.get('domain')})}}"><i class="fa fa-dashboard"></i>Dashboard</a></li>
		  <li><a href="{{path('admin_branch_index',{'domain':app.session.get('domain')})}}"><i class="fa fa-dashboard"></i>Branch List</a></li>
		  <li class="active">Add-Update Branch</li>
		</ol>
	  </section>
		<section class="content">
		{% for flashMessage in app.session.flashbag.get('success_msg') %}
		<div class="alert alert-success alert-dismissable">
			<button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
			<h4><i class="icon fa fa-check"></i> Alert!</h4>{{ flashMessage }}
		</div>
		{% endfor %}
		{% for flashMessage in app.session.flashbag.get('error_msg') %}
		<div class="alert alert-danger alert-dismissable">
			<button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
			<h4><i class="icon fa fa-check"></i> Alert!</h4>{{ flashMessage }}
		</div>
		{% endfor %}
		<div class="row">
			<div class="col-xs-12">
				<div class="box box-primary">					
					<div class="box-body">
						<div class="nav-tab-custom">
							<ul class="nav nav-tabs">
								{% if  language is defined %}
									{% for lang in language %}
										<li {% if loop.index == 1 %}class="active"{% endif %}>
											<a href="#tab_{{lang.language_master_id}}" data-toggle="tab">{{lang.language_name}}</a>
										</li>
									{% endfor %}
								{% endif %}
							</ul>
						</div>
						<div class="tab-content">		
								{% if language is defined %}
									{% for lang in language %}
										 <div class="tab-pane fade{% if loop.index == 1 %}in active{% endif %}" id="tab_{{lang.language_master_id}}">
										  {% if branch is defined and branch is not empty %}
											{% set main_branch_id = 0 %}
											  {% for branch in branch %}
												  {% set main_branch_id = branch.main_branch_id %}
											  {% endfor %}
										  {% endif %}
										  <form id="manage_branch_{{lang.language_master_id}}" class="form" method="POST" enctype="multipart/form-data" action="{% if branch is defined and branch is not empty %}{{path('admin_branch_updatebranch',{'domain':app.session.get('domain'),main_branch_id:main_branch_id})}}{%else%}{{path('admin_branch_savebranch',{'domain':app.session.get('domain')})}}{%endif%}">
												<br/>
												<div class="row">
													<div class="col-md-12">
														<label class="col-md-2 control-label">Domain Name</label>
														<div class="col-md-10">
														  
															<select name="domain_id" class="form-control select" onchange="getCompany(this.value,{{lang.language_master_id}})" required>
															    <option value="">Select Domain Name</option>
																{% if domain is defined and domain is not empty %}
																  {% for domain in domain %}
																	<option value="{{domain.domain_code}}" {% if branch is defined and branch is not empty %}{% for branch in branch %}{% if (branch.domain_code) == (domain.domain_code) %}selected="selected"{%endif%}{%endfor%}{%endif%}>{{domain.domain_name}}</option>
																  {%endfor%}
																{% endif %}
															</select>
														</div>
													</div>
												</div>
												<br/>
												<div class="row">
													<div class="col-md-12">
														<label class="col-md-2 control-label">Company Name</label>
														<div class="col-md-10">
															<select name="company_id" id="company_id{{lang.language_master_id}}" class="form-control select" required>
															    <option value="">Select Company</option>
															</select>
														</div>
													</div>
												</div>
												<br/>
												<div class="row">
													  <div class="col-md-12">
															<label class="control-label col-md-2">Branch Name</label>
															<div class="col-md-10">
															  <input type="text" class="form-control" name="branch_name" placeholder="Enter Branch Title" value="{% if branch is defined and branch is not empty %}{% for branch in branch %}{% if (branch.language_id) == (lang.language_master_id) %}{{branch.branch_name}}{%endif%}{%endfor%}{%endif%}" required/>
															</div> 
													  </div>													 
												 </div>
												<br>
												<div class="row">
													  <div class="col-md-12">
															<label class="col-md-2 control-label">Branch Description</label> 
															<div class="col-md-10">
															  <textarea class="textarea" name="branch_desc" placeholder="Enter Branch Description" style="width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;">{% if branch is defined and branch is not empty %}{% for branch in branch %}{% if (branch.language_id) == (lang.language_master_id) %}{{branch.branch_description}}{%endif%}{%endfor%}{%endif%}</textarea>
															</div> 
													  </div>													 
												</div>
												<br/>
												 <div class="form-group">
													  <div class="col-sm-10 pull-left">
														  <button name="save" type="submit" class="btn btn-primary" value="{{lang.language_master_id}}">{% if branch is defined and branch is not empty %}Update{%else%}Save{%endif%}</button>
														  <a href="{{path('admin_branch_index',{'domain':app.session.get('domain')})}}"  class="btn btn-default form-btn">Cancel</a>
													  </div>
												</div>
										  </form>
										 </div>
									{% endfor %}
								{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

{% endblock %}

{% block js %}
  
<script language="Javascript" src="{{asset('bundles/design/')}}tinymce/tinymce.min.js" type="text/javascript"></script>
  
<script language="Javascript" type="text/javascript">
tinymce.init({
    selector: "textarea",
	max_chars : 1000,
	width:      '100%',
	height:     '50%',
    plugins: [
        "advlist autolink lists link charmap print preview anchor",
        "searchreplace visualblocks code",
        "insertdatetime table contextmenu paste moxiemanager",
		"textcolor"
    ],
    statusbar:  true,
	menubar:    true,
    toolbar: "sizeselect | fontselect |  fontsizeselect | forecolor backcolor | undo redo | bold underline italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link",

	rel_list:   [ { title: 'Lightbox', value: 'lightbox' } ]
});
function validate(){

	var textarea = tinymce.get('description').getContent();
	if ( (textarea=="") || (textarea==null) ) {
        tinymce.get('description').focus();
		return false; 
	}
	return true;
}

</script>
  
<script type="text/javascript">

window.onload = function() {
 {% if branch is defined and branch is not empty %}
		{% for branch in branch %}
			getCompany({{branch.domain_id}},{{branch.language_id}});
		{% endfor %}
	{% endif %}
};
$(document).ready(function() {
	{% if branch is defined and branch is not empty %}
		{% for branch in branch %}
			getCompany({{branch.domain_code}},{{branch.language_id}});
		{% endfor %}
	{% endif %}
	
	{% for lang in language %}
	$('#manage_branch_{{lang.language_master_id}}').bootstrapValidator({
			fields: {
				domain_id: {
					validators: {
						notEmpty: {
							message: '* Domain is required and cannot be empty'
						 }
					 }
				 },
				 company_id: {
					validators: {
						notEmpty: {
							message: '* Company is required and cannot be empty'
						 }
					 }
				 },
				 branch_name: {
					validators: {
						notEmpty: {
							message: '* Branch Name is required and cannot be empty'
						 }
					 }
				 },
			 }
		 });
	  {% endfor %}
	
});

function getCompany(val,lang_id) {
	//call ajax
	//alert(val);
	//alert(lang_id);
		$.ajax({
			type : "POST",
			url : "{{path('admin_branch_getcompanys',{'domain':app.session.get('domain')})}}",
			data :{"domain_id":val,"lang_id":lang_id,"flag":"domain_change"},
		    dataType: 'html',
			success : function(resp){
				if (resp) {
					$('#company_id'+lang_id).html(resp);
					{% if branch is defined and branch is not empty %}
						{% for branch in branch %}
							  $('#company_id'+lang_id+' option:eq('+ {{branch.company_id}}+')').attr('selected', 'selected')
						{% endfor %}
					{% endif %}
				}else{
					 alert("No Company");
				}
			}
		}) ;
}

</script>
{% endblock %}