{% extends "AdminBundle::Layout/adminlayout.html.twig" %}
{% block title %} Add Pricing Rule {% endblock %}
{% block css %}
<link href="{{asset('bundles/design/')}}css/bootstrape_verticle_tab.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="{{asset('bundles/design/')}}plugins/select2/select2.min.css">
<link rel="stylesheet" href="{{asset('bundles/design/')}}plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
<link rel="stylesheet" href="{{asset('bundles/design/')}}plugins/iCheck/all.css">
<link rel="stylesheet" href="{{asset('bundles/design/')}}fileupload/css/blueimp-gallery.min.css">
<link rel="stylesheet" href="{{asset('bundles/design/')}}fileupload/css/jquery.fileupload.css">
<link rel="stylesheet" href="{{asset('bundles/design/')}}fileupload/css/jquery.fileupload-ui.css">
<link href="{{asset('bundles/design/')}}css/datepicker3.css" rel="stylesheet" type="text/css" />
 <style>
    .verticle_tab .active a
    {
        background-color: #3fd5af !important;
        color: #FFF !important;
    }
    .verticle_tab a
    {
        color: #000 !important;
    }
    .col-xs-2
    {
        padding-right: 0px !important;
    }
	.select2-container
	{
		 width: 100% !important;
	}
	.desabletab
	{
		 pointer-events: none !important;
		 background-color: #ccc !important;
	}
 </style>
{% endblock %}
{% block content %}
<section class="content-header">
		<h1>
            {% if product_info is defined %}Edit{% else %}Add{% endif %} product
		  <small></small>
		</h1>
		<ol class="breadcrumb">
		  <li><a href="{{path('admin_dashboard_index',{'domain':app.session.get('domain')})}}"><i class="fa fa-dashboard"></i>Dashboard</a></li>
		  <li><a href="{{path('admin_product_index',{'domain':app.session.get('domain')})}}">Product list</a></li>
          <li class="active">Add product</li>
		</ol>
	  </section>
	  <section class="content">
		 {% for flashMessage in app.session.flashbag.get('success_msg') %}
			<div role="alert" class="alert alert-success alert-dismissible fade in">
				 <button aria-label="Close" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>
				 <strong>Alert!</strong>&nbsp; {{ flashMessage }}
		    </div>
	     {% endfor %}
		 {% for flashMessage in app.session.flashbag.get('warning_msg') %}
			<div role="alert" class="alert alert-warning alert-dismissible fade in">
				 <button aria-label="Close" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>
				 <strong>Alert!</strong>&nbsp; {{ flashMessage }}
			</div>
	     {% endfor %}
	     {% for flashMessage in app.session.flashbag.get('error_msg') %}
			<div role="alert" class="alert alert-danger alert-dismissible fade in">
				 <button aria-label="Close" data-dismiss="alert" class="close" type="button"><span aria-hidden="true">×</span></button>
				 <strong>Alert!</strong>&nbsp; {{ flashMessage }}
			</div>
	     {% endfor %}
		 
		<div class="row">
            <div class="col-xs-2">
                <div class="box box-solid">
                    <div class="row">
                        <div class="col-xs-12">
                          <!-- Nav tabs -->
                          <ul class="nav nav-pills tabs-left verticle_tab">
                            <li class="active"><a href="#info" data-toggle="tab">Rule Information</a></li>
                            <li><a href="#category" {% if pricing_rule_list is defined and pricing_rule_list is not empty %}data-toggle="tab" {% else %}class="desabletab"{% endif %}>Conditions</a></li>
                            <li><a href="#media" {% if pricing_rule_list is defined and pricing_rule_list is not empty %}data-toggle="tab" {% else %}class="desabletab"{% endif %}>Actions</a></li>
                            
                          </ul>
                        </div>
                    </div>  
                </div>
            </div>
            
            <div class="col-xs-10">
                <div class="box box-solid">
                    <div class="row">
                        <div class="col-xs-12">
                          <!-- Tab panes -->
                            <div class="tab-content">
							  <div class="tab-pane active" id="info">
									{% if language is defined and language is not empty%}
									<ul class="nav nav-pills">
									   {% for lang in language %}
									   <li {% if loop.index == 1 %} class="active"{% endif %}><a href="#basic_{{lang.language_master_id}}" data-toggle="tab">{{lang.language_name}}</a></li>
									   {% endfor %}
									</ul>
									{% endif %}
									
									<div class="tab-content">
									   {% if language is defined and language is not empty%}
										  {% for lang in language %}
										  <div class="tab-pane{% if loop.index == 1 %} active{% endif %}" id="basic_{{lang.language_master_id}}">
										  <form method="post" id="basic_form"  action="{% if pricing_rule_list is defined and pricing_rule_list is not empty %} {{path('admin_pricing_updatepricingrule',{'domain':app.session.get('domain'),'main_rule_id':pricing_rule_list[0].main_pricing_rule_id})}}{% else %} {{path('admin_pricing_savepricingrule',{'domain':app.session.get('domain')})}}{% endif %}
											 
											">
											 <input type="hidden" name="basic_language_id" id="basic_language_id_{{lang.language_master_id}}" value="{{lang.language_master_id}}" />
											 <div class="box-body form-horizontal">
												<div class="form-group">
												  <label class="col-sm-2 control-label">Name</label>
												  <div class="col-sm-4">
													<input type="text" class="form-control" name="price_rule_name" value="{% if pricing_rule_list is defined and pricing_rule_list is not empty %}{% for pricing_rule_list in pricing_rule_list %}{% if pricing_rule_list.language_id == lang.language_master_id %}{{pricing_rule_list.rule_title}}{% endif %}{% endfor %}{% endif %}">
												  </div>
												   <label class="col-sm-2 control-label">Pricing code</label>
												  <div class="col-sm-4">
													<input type="text" class="form-control" name="price_rule_code" value="{% if pricing_rule_list is defined and pricing_rule_list is not empty %}{{pricing_rule_list[0].price_rule_code}}{% endif %}">
												  </div>
												</div>
												<div class="form-group">
												  <label class="col-sm-2 control-label">Start Date</label>
												  <div class="col-sm-4">
													<div class="input-group date" data-provide="datepicker" data-date-format="yyyy-mm-dd">
													<input type="text" name="start_date" id="start_date" required readonly class="form-control" value="{% if pricing_rule_list is defined and pricing_rule_list is not empty %}{{pricing_rule_list[0].start_date}}{% endif %}">
														<div class="input-group-addon">
															<span class="glyphicon glyphicon-th"></span>
														</div>
													  </div>
												  </div>
												   <label class="col-sm-2 control-label">End Date</label>
												  <div class="col-sm-4">
													  <div class="input-group date" data-provide="datepicker" data-date-format="yyyy-mm-dd">
														<input type="text" name="end_date" id="end_date" readonly required class="form-control" value="{% if pricing_rule_list is defined and pricing_rule_list is not empty %}{{pricing_rule_list[0].end_date}}{% endif %}">
														<div class="input-group-addon">
															<span class="glyphicon glyphicon-th"></span>
														</div>
													  </div>
												  </div>
												  
												</div>
												<div class="form-group">
												  <label class="col-sm-2 control-label">Status</label>
												  <div class="col-sm-5">
													  
														 <label>
														  <input type="radio" class="minimal" name="status" value="active" {% if pricing_rule_list is defined and pricing_rule_list is not empty and pricing_rule_list[0].status == 'active' %}checked{% endif %}>&nbsp;&nbsp; Active
														  </label>
														  &nbsp;&nbsp;&nbsp;&nbsp;
														  <label>
														  <input type="radio" class="minimal" name="status" value="inactive" {% if pricing_rule_list is defined and pricing_rule_list is not empty and pricing_rule_list[0].status == 'inactive' %}checked{% endif %}>&nbsp;&nbsp; Inactive
														  </label>
													  
												  </div>
												</div>
												
												<div class="form-group">
												  <label class="col-sm-2 control-label">Description</label>
												  <div class="col-sm-10">
													  <textarea class="form-control" name="rule_description">{% if pricing_rule_list is defined and pricing_rule_list is not empty %}{% for pricing_rule_list in pricing_rule_list %}{% if pricing_rule_list.language_id == lang.language_master_id %}{{pricing_rule_list.rule_description}}{% endif %}{% endfor %}{% endif %}</textarea>
												  </div>
												</div>
												
											</div>
											 <div class="box-footer">
												<button type="submit" class="btn btn-default">Cancel</button>
												{% if pricing_rule_list is defined and pricing_rule_list is not empty %}
												   <button type="submit" class="btn btn-primary pull-right" name="update_basic_info" value="update_basic_info">Update</button>
												{% else %}
												   <button type="submit" class="btn btn-primary pull-right" name="save_basic_info" value="save_basic_info">Save</button>
												{% endif %}
											</div>
										  </form>	 
										  
										  </div>
										  
										  {% endfor %}
									   {% endif %}
									</div>
								  
								  
								 </div>
                                 <div class="tab-pane" id="category">
									{% macro menu_links(links) %}
									   {% import _self as macros %}
									   {% for link in links %}
										   <li class="collapsed cat{{link.main_category_id}}" >
											   <input type="checkbox"  value="{{ link.main_category_id }}" name="category_selected[]" onclick="set_category_selected('cat{{link.main_category_id}}');"> &nbsp;&nbsp;&nbsp;{{ link.category_name }}
											   {% if link.child_data %}
												   <ul style="list-style-type: none;">
													   {{ macros.menu_links(link.child_data) }}
												   </ul>
											   {% endif %}
										   </li>
									   {% endfor %}
									{% endmacro %}
									{% import _self as macros %}
									{% if language is defined and language is not empty %}
									   <ul class="nav nav-pills">
									   
										   {% for lang in language %}
										   <li {% if loop.index == 1 %}class="active"{% endif %}><a data-toggle="tab" href="#category_tab_{{lang.language_master_id}}">{{lang.language_name}}</a></li>
										   {% endfor %}
										
									   </ul>
									  <div class="tab-content">
									   {% for lang in language %}
									   <div id="category_tab_{{lang.language_master_id}}" class="tab-pane{% if loop.index == 1 %} active{% endif %}">
										   <form method="post" class="form-horizontal" action="{{path('admin_product_saveproductcategory',{'domain':app.session.get('domain')})}}" enctype="multipart/form-data">
											 
											 <div class="box-body">
											   <input type="hidden" name="language_id"  value="{{lang.language_master_id}}" />
												<input type="hidden" name="main_product_id"  value="{%if main_product_id is defined and main_product_id is not empty %} {{main_product_id}} {%endif%}" />
											   <div class="form-group">													
											   </div>
											 </div>
											<div class="box-footer">
											   <button type="submit" class="btn btn-default">Cancel</button>
											   <button type="submit" class="btn btn-primary pull-right">Save</button>
										   </div>
										   </form>
		   
									   </div>
									   {% endfor %}
									 </div>
									{% endif %} 
                                  
                                </div>
                                <div class="tab-pane" id="media">
                                    <div class="box-body form-horizontal">
									   {# File upload plugin html code : START #}
									   <form id="fileupload" method="POST" enctype="multipart/form-data">         
										   <div class="row fileupload-buttonbar">
											   <div class="col-lg-7">
												   
												   <span class="btn btn-success fileinput-button">
													   <i class="glyphicon glyphicon-plus"></i>
													   <span>Add files...</span>
													   <input type="file" name="files[]" multiple>
												   </span>
												   <button type="submit" class="btn btn-primary start">
													   <i class="glyphicon glyphicon-upload"></i>
													   <span>Start upload</span>
												   </button>
												   <button type="reset" class="btn btn-warning cancel">
													   <i class="glyphicon glyphicon-ban-circle"></i>
													   <span>Cancel upload</span>
												   </button>
												   {#<button type="button" class="btn btn-danger delete">
													   <i class="glyphicon glyphicon-trash"></i>
													   <span>Delete</span>
												   </button>
												   <input type="checkbox" class="toggle">#}
												   <!-- The global file processing state -->
												   <span class="fileupload-process"></span>
											   </div>
										   
											   <div class="col-lg-5 fileupload-progress fade">
												   <!-- The global progress bar -->
												   <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
													   <div class="progress-bar progress-bar-success" style="width:0%;"></div>
												   </div>
												   <!-- The extended global progress state -->
												   <div class="progress-extended">&nbsp;</div>
											   </div>
										   </div>
									   <table role="presentation" class="table table-striped">
										<tbody class="files">
											 {% if media_library_master is defined and media_library_master is not empty %}
												{% for media in media_library_master %}
												   <tr class="template-download fade in">
													  <td>
														  <span class="preview">
															 <a data-gallery="" download="{{media.media_name}}" title="{{media.media_name}}" href="{{live_path}}{{media.media_location}}/{{media.media_name}}">
																<img src="{{live_path}}{{media.media_location}}/thumbnail/{{media.media_name}}">
															  </a>
														  </span>
													  </td>
													  <td>
														  <p class="name">
															  <a data-gallery="" download="{{media.media_name}}" title="{{media.media_name}}" href="{{live_path}}{{media.media_location}}/{{media.media_name}}">{{media.media_name}}</a>
														  </p>
													  </td>
													  <td style="width:20px;">
														<input type="radio" name="default_image" class="" value="1" onclick="set_default_image({{product_info[0].main_product_master_id}},{{media.media_library_master_id}});" title="Set default product image">
													  </td>
													  <td>
														  <button class="btn btn-danger delete" onclick="delete_image({{media.media_library_master_id}},{{media.gallery_master_id}});">
																  <i class="glyphicon glyphicon-trash"></i>
																  <span>Delete</span>
															  </button>
													  </td>
												   </tr>
												{% endfor %}
											 {% endif %}
										</tbody>
									   </table>
								   </form>
								   {# File upload plugin html code : END #}
								 </div>
								 <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls" data-filter=":even">
									  <div class="slides"></div>
									  <h3 class="title"></h3>
									  <a class="prev">‹</a>
									  <a class="next">›</a>
									  <a class="close">×</a>
									  <a class="play-pause"></a>
									  <ol class="indicator"></ol>
								  </div>         
                                </div>
                              </div>
            </div>
        </div>    
</section>
{% endblock %}
{% block js %}
<script src="{{asset('bundles/design/')}}js/bootstrap-datepicker.js" type="text/javascript"></script>
<script>
   function onsupplierchange(val) {
	var id= val.value;
	var cls = "";
	  if ($(val).is(':checked')) {
		// alert(id);
		$( "#"+id ).removeClass('collapsed-box');
		
	  }else{
		 //alert();
		 $( "#"+id ).addClass('collapsed-box');
	  }
	  
   }
   
</script>
   
<script id="template-upload" type="text/x-tmpl">
{% verbatim %}
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td>
            <span class="preview"></span>
        </td>
        <td>
            <p class="name">{%=file.name%}</p>
            <strong class="error text-danger"></strong>
        </td>
        <td>
            <p class="size">Processing...</p>
            <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
        </td>
        <td>
            {% if (!i && !o.options.autoUpload) { %}
                <button class="btn btn-primary start" disabled>
                    <i class="glyphicon glyphicon-upload"></i>
                    <span>Start</span>
                </button>
            {% } %}
            {% if (!i) { %}
                <button class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel</span>
                </button>
            {% } %}
        </td>
    </tr>
{% } %}
{% endverbatim %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
{% verbatim %}
{% endverbatim %}
</script>
<script src="{{asset('bundles/design/')}}plugins/select2/select2.full.min.js"></script>
<script src="{{asset('bundles/design/')}}plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<script src="{{asset('bundles/design/')}}plugins/select2/select2.full.min.js"></script>
<script src="{{asset('bundles/design/')}}plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<script language="Javascript" src="{{asset('bundles/design/')}}tinymce/tinymce.min.js" type="text/javascript"></script>
<script src="{{asset('bundles/design/')}}plugins/iCheck/icheck.min.js"></script>

<script src="{{asset('bundles/design/')}}fileupload/js/jquery.ui.widget.js"></script>
<!-- The Templates plugin is included to render the upload/download listings -->
<script src="{{asset('bundles/design/')}}fileupload/js/tmpl.min.js"></script>
<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="{{asset('bundles/design/')}}fileupload/js/load-image.all.min.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="{{asset('bundles/design/')}}fileupload/js/canvas-to-blob.min.js"></script>
<!-- blueimp Gallery script -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.blueimp-gallery.min.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload.js"></script>
<!-- The File Upload processing plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload-validate.js"></script>
<!-- The File Upload user interface plugin -->
<script src="{{asset('bundles/design/')}}fileupload/js/jquery.fileupload-ui.js"></script>
<!-- The main application script -->
{#<script src="{{asset('bundles/design/')}}fileupload/js/main.js"></script>#}
<script>
$("#basic_form").validate({
	  rules: {
		  price_rule_name: "required",
		  price_rule_code: "required"
	  },
	  messages: {
		  price_rule_name: "Please Enter Price Rule title",
		  price_rule_code: "Please Enter Rule code"
	  }
  });
{% if product_info is defined and product_info is not empty %}
$(function () {
var html = "";
    'use strict';
    // Initialize the jQuery File Upload widget:
    $('#fileupload').fileupload({
        // Uncomment the following to send cross-domain cookies:
        xhrFields: {withCredentials: true},
        url: '{{live_path}}/bundles/design/index.php?temp_dir=product_image',
		success: function(response)
		{
		    //console.log(response.files[0]);
			//database insert ajax
			$.ajax({
			type: 'POST',
			url : "{{ path('admin_product_saveproductgallery',{'domain':app.session.get('domain')}) }}",
			data: {"img_name":response.files[0].name,'main_product_id':{{product_info[0].main_product_master_id}},'media_type_id':1,'flag':'save_gallery_image'},
			async: false,
			dataType: 'json',
			success: function(response)
			{
					 
					 if (response != false)
					 {
						   html += '<tr class="template-download fade in">';
							  html += '<td>';
								  html += '<span class="preview">';
									  html += '<a data-gallery="" download="'+response.name+'" title="'+response.name+'" href="'+response.path+'">';
										html += '<img src="'+response.thumbnail_path+'">';
									  html += '</a>';
								  html += '</span>';
							  html += '</td>';
							  html += '<td>';
								  html += '<p class="name">';
									  html += '<a data-gallery="" download="'+response.name+'" title="'+response.name+'" href="'+response.path+'">'+response.name+'</a>';
								  html += '</p>';
							  html += '</td>';
							  html += '<td style="width:20px;">';
								html += '<input type="radio" name="default_image" class="" value="1" onclick="set_default_image({{product_info[0].main_product_master_id}},'+response.media_library_master_id+');" title="Set default product image">';
							  html += '</td>';
							  html += '<td>';
								  html += '<button class="btn btn-danger delete" onclick="delete_image('+response.media_library_master_id+','+response.gallery_master_id+');">';
										  html += '<i class="glyphicon glyphicon-trash"></i>';
										  html += '<span>Delete</span>';
									  html += '</button>';
									  //html += '<input type="checkbox" class="toggle" value="1" name="delete">';
							  html += '</td>';
						  html += '</tr>';
						  $(".files").append(html);
						  html = "";
                     }
					 
			   }
			});
			$('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
			checkboxClass: 'icheckbox_minimal-blue',
			radioClass: 'iradio_minimal-blue'
			});
	    }
    });
});
function delete_image(media_library_master_id,gallery_master_id)
{
	$.ajax({
		type: 'POST',
		url : "{{ path('admin_product_removeproductimage',{'domain':app.session.get('domain')}) }}",
		data: {"media_library_master_id":media_library_master_id,'gallery_master_id':gallery_master_id,'flag':'delete_image'},
		async: false,
		dataType: 'json',
		success: function(response)
		{
			
		}
	});
}
function set_default_image(main_product_master_id,media_library_master_id)
{
   $.ajax({
		type: 'POST',
		url : "{{ path('admin_product_setdefaultimage',{'domain':app.session.get('domain')}) }}",
		data: {"main_product_master_id":main_product_master_id,'media_library_master_id':media_library_master_id,'flag':'set_default_product_image'},
		async: false,
		dataType: 'json',
		success: function(response)
		{
			
		}
	});
}
{% endif %}
</script>
<script language="Javascript" type="text/javascript">
tinymce.init({
    selector: "textarea",
	max_chars : 1000,
	width:      '100%',
	height:     '10%',
    plugins: [
        "advlist autolink lists link charmap print preview anchor",
        "searchreplace visualblocks code",
        "insertdatetime table contextmenu paste moxiemanager",
		"textcolor"
    ],
    statusbar:  true,
	menubar:    true,
    toolbar: "sizeselect | fontselect |  fontsizeselect | forecolor backcolor | undo redo | bold underline italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link",

	rel_list:   [ { title: 'Lightbox', value: 'lightbox' } ]
});

function validate(){

	var textarea = tinymce.get('description').getContent();
	if ( (textarea=="") || (textarea==null) ) {
        tinymce.get('description').focus();
		return false; 
	}
	return true;
}
</script>
<script>
$(function () {
   $(".select2").select2();
   $(".editor").wysihtml5();
});
$('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
checkboxClass: 'icheckbox_minimal-blue',
radioClass: 'iradio_minimal-blue'
});
</script>
{% endblock %}